<!-- Tab navbar -->
<div class = "sticky-top bg-light">
  <!-- General Nav bar -->
  <nav class = "navbar navbar-expand-lg navbar-light bg-dark p-0">
    <div class = "container-fluid">
      <a class = "navbar-brand" href = "#">
        <%= image_tag "bsfc_logo.png", {:alt => "Berkeley Student Food Collective Logo", :width => 40, :height => 40} %>
      </a>
      <ul class = "navbar-nav">
        <li class = "nav-item">
          <small style = "color: white;">Welcome <%= current_user.name %></small>
        </li>
        <!-- <li class = "nav-item">
          <%= link_to "Log Out", logout_path, class: "nav-link text-light" %>
        </li> -->
      </ul>
    </div>
  </nav>

  <!-- Tasks nav bar -->
  <div>
    <!-- Switch between tabs -->
    <div class = "dropdown w-100 px-1 border-bottom border-dark">
      <a class = "btn btn-light dropdown-toggle" href = "#" role = "button" id = "dropdown-nav" data-bs-toggle = "dropdown" aria-expanded = "false">
        Tasks
      </a>
      <div class = "dropdown-menu w-100" aria-labelledby = "dropdown-nav">
        <%= link_to "Announcements", announcements_path, class: "dropdown-item" %>
      </div>
    </div>

    <!-- Select category and add task-->
    <div class = "d-flex align-items-center justify-content-between px-3 py-1">
      <div class = "d-flex align-items-center">
        <small class = "me-1 my-2">Filter tasks by</small>
        <select onchange = "location = this.value;" class = "border-0 bg-light rounded text-secondary">
          <option selected value = "<%= filter_path(:category => 'All Categories') %>">All Categories</option>
          <% @categories.each do |task| %>
            <option value = "<%= filter_path(:category => task.category) %>"><%= task.category %></option>
          <% end %>
        </select>
      </div>
      <button type = "button" class = "btn btn-sm btn-danger" data-bs-toggle = "modal" data-bs-target = "#add-task-modal">Add Task +</button>
    </div>
  </div>
</div>

<!-- Modal -->
<div class = "modal fade" id = "add-task-modal" tabindex = "-1" aria-labelledby = "add-task-modal" aria-hidden = "true">
  <div class = "modal-dialog">
    <div class = "modal-content">
      <div class = "modal-header">
        <h5 class = "modal-title">Add New Task</h5>
        <button type = "button" class = "btn-close" data-bs-dismiss = "modal" aria-label = "Close"></button>
      </div>
      <div class = "modal-body">
        <div class = "d-flex justify-content-end">
          <%= image_tag "bsfc_logo.png", {:alt => "Berkeley Student Food Collective Logo", :width => 100, :height => 100} %>
        </div>
        <%= form_tag tasks_create_path, :method => "post", :class => "" do %>
          <div class = "mb-2">
            <%= label_tag :task_name, "Task Name", class: "form-label" %>
            <%= text_field_tag :task_name, nil, :placeholder => "New Task...", :class => "form-control" %>
          </div>
          <div class = "mb-2">
            <%= label_tag :task_description, "Task Description", class: "form-label" %>
            <%= text_area_tag :task_description, nil, :placeholder => "Add new task description...", :class => "form-control" %>
          </div>
          <div class = "mb-2">
            <%= label_tag :task_category, "Task Category", class: "form-label" %>
            <%= select_tag :task_category, raw("<option>Inventory</option><option>Register</option>"), :class => "form-control" %>
          </div>
          <div class = "d-flex justify-content-center">
            <%= label_tag nil, "Task Priority", class: "form-label" %>
          </div>
          <div class = "mb-3 d-flex justify-content-center">
            <div class = "form-check form-check-inline">
              <%= radio_button_tag :priority, 1, false, class: "form-check-input" %>
              <%= label_tag :priority_low, 'Low', class: "form-check-label text-success" %>
            </div>
            <div class = "form-check form-check-inline">
              <%= radio_button_tag :priority, 2, false, class: "form-check-input" %>
              <%= label_tag :priority_medium, 'Medium', class: "form-check-label text-warning" %>
            </div>
            <div class = "form-check form-check-inline">
              <%= radio_button_tag :priority, 3, false, class: "form-check-input" %>
              <%= label_tag :priority_high, 'High', class: "form-check-label text-danger" %>
            </div>
          </div>
          <div class = "mb-2 d-flex justify-content-center">
            <%= submit_tag "Add Task +", :class => "btn btn-danger" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>


<div class="center">
  <h5>Incomplete Tasks</h5>
</div>
<% @first = true %>
<% @tasks.each do |task| %>
  <% unless task.completed %>
    <!-- Tasks div -->
    <div id="tasks-div" class="container">
      <!-- Task panel -->
      <div class="task-panel row px-1 py-1 border-bottom<%= @first ? " border-top" : "" %> border-dark">
        <% @first = false %>
        <!-- Checkbox -->
        <div class="col-1 d-flex flex-column justify-content-center align-items-center">
          <%= button_to "✔️", checkmark_path(:task => task, :user => current_user), class: "btn btn-success" %>
        </div>

        <!-- Right side of panel -->
        <div class="col-9 ps-4 justify-content-between align-items-center">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="fw-bold m-0">
              <%=   task.name   %>
            </h5>
          </div>
          <p class="fw-lighter small m-0"><small>
            Posted by <%=   task.user_add   %> at <%=   task.added   %>
          </small></p>
          <p class="m-0">
            <small>
              <%= task.description %>
            </small>
          </p>
        </div>
        <div class="col-1 d-flex flex-column justify-content-center align-items-center">
          <span class="badge bg-dark">
            <%= task.category %>
          </span>
          <h1 class = <%= priority_color task.priority %>>
            <%= priority_visualizer task.priority  %>
          </h1>
        </div>
        <div class="col-1 d-flex flex-column justify-content-center align-items-center">
          <div class = 'triple-dot-menu'></div>
        </div>
      </div>
    </div>
  <% end %>
<% end %>



<div class="center">
  <h5>Completed Tasks</h5>
</div>
<% @first = true %>
<% @tasks.each do |task| %>
  <% if task.completed %>
    <!-- Tasks div -->
    <div id="tasks-div" class="container">
      <!-- Task panel -->
      <div class="task-panel row px-1 py-1 border-bottom<%= @first ? " border-top" : "" %> border-dark">
      <% @first = false %>
        <!-- Checkbox -->
        <div class="col-1 d-flex flex-column justify-content-center align-items-center">
          <%= button_to "❌", checkmark_path(:task => task, :user => current_user), class: "btn btn-danger" %>
        </div>

        <!-- Right side of panel -->
        <div class="col-9 ps-4">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="fw-bold m-0">
              <%=  task.name  %>
            </h5>
          </div>
          <p class="fw-lighter small m-0"><small>
            Completed by <%=  task.user_complete  %> at <%= task.complete_time %>
          </small></p>
          <p class="fw-lighter small m-0"><small>
            Posted by <%= task.user_add %> at <%=  task.added  %>
          </small></p>
          <p class="m-0">
            <small>
              <%=  task.description  %>
            </small>
          </p>
        </div>
        <div class="col-1 d-flex flex-column justify-content-center align-items-center">
          <span class="badge bg-dark">
            <%=   task.category  %>
          </span>
          <h1 class = <%= priority_color task.priority %>>
            <%= priority_visualizer task.priority  %>
          </h1>
        </div>
        <div class="col-1 d-flex flex-column justify-content-center align-items-center">
          <div class = 'triple-dot-menu'></div>
        </div>
      </div>
    </div>
  <% end %>
<% end %>


<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
